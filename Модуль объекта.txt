Функция ПреобразоватьКМассивуСсылок(ЗначениеКонстанты)

    Результат = Новый Массив;

    Если ТипЗнч(ЗначениеКонстанты) = Тип("Строка") Тогда
        Для Каждого GUID Из СтрРазделить(ЗначениеКонстанты, ";") Цикл
            Если GUID <> "" Тогда
                Ссылка = Справочники.Платформы.НайтиПоУникальномуИдентификатору(GUID);
                Если Не Ссылка.Пустая() Тогда
                    Результат.Добавить(Ссылка);
                КонецЕсли;
            КонецЕсли;
        КонецЦикла;

    ИначеЕсли ТипЗнч(ЗначениеКонстанты) = Тип("Массив") Тогда
        Результат = ЗначениеКонстанты;

    ИначеЕсли ТипЗнч(ЗначениеКонстанты) = Тип("ТаблицаЗначений") Тогда
        Для Каждого Стр Из ЗначениеКонстанты Цикл
            Результат.Добавить(Стр.Платформа);
        КонецЦикла;
    КонецЕсли;

    Возврат Результат;

КонецФункции


Процедура УдалитьНеКлючевые()

    ЗначениеКонстанты = Константы.ПлатформыРезерв.Получить();
    СписокПлатформ = ПреобразоватьКМассивуСсылок(ЗначениеКонстанты);

    Оставшиеся = Новый Массив;
    Удалённые = Новый Массив;

    Для Каждого Платформа Из СписокПлатформ Цикл
        Если Платформа.Ключевая Тогда
            Оставшиеся.Добавить(Платформа);
        Иначе
            Удалённые.Добавить(Платформа);
        КонецЕсли;
    КонецЦикла;

    // сортировки
    Оставшиеся.СортироватьПоВозрастанию("ЧисловойКод", Ложь); // убывание
    Удалённые.СортироватьПоВозрастанию("ЧисловойКод");        // возрастание

    // записываем обратно
    Константы.ПлатформыРезерв.Установить(Оставшиеся);

    // формируем таблицу для формы
    Таблица = Новый ТаблицаЗначений;
    Для Каждого Платформа Из Оставшиеся Цикл
        Таблица.Колонки.Добавить(Платформа.Наименование, Новый ОписаниеТипов(Тип("СправочникСсылка.Платформы")));
    КонецЦикла;

    Стр = Таблица.Добавить();
    Для Каждого Платформа Из Оставшиеся Цикл
        Стр[Платформа.Наименование] = Платформа;
    КонецЦикла;

    ЭлементыФормы.ТаблицаПлатформ.Значение = Таблица;

    // сообщение
    Если Удалённые.Количество() > 0 Тогда
        Сообщение = "Удалены платформы: ";
        Для Каждого Платформа Из Удалённые Цикл
            Сообщение = Сообщение + Платформа.Наименование + ", ";
        КонецЦикла;
        Сообщить(Лев(Сообщение, СтрДлина(Сообщение)-2));
    КонецЕсли;

КонецПроцедуры